<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to <code>hesim</code> • hesim</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to &lt;code&gt;hesim&lt;/code&gt;">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hesim</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased package">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/psm.html">Partitioned survival models</a>
    </li>
    <li>
      <a href="../articles/icea.html">Individualized cost-effectiveness analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/hesim">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to <code>hesim</code>
</h1>
            
            <h4 class="date">2018-08-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/InnovationValueInitiative/hesim/blob/master/vignettes/intro.Rmd"><code>vignettes/intro.Rmd</code></a></small>
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p><code>hesim</code> is designed to facilitate the development of high performance health-economic simulation models and the analysis of the output of said models. A decision model is built by specifying a model structure, which consists of three submodels that are each a function of parameters and input data: a set of statistical models for predicting or simulating disease progression, a model for utility values, and set of cost models for each potential cost category (e.g., costs of medical care, drug costs). The disease model is used to model the probability of being in given disease state and the utility and costs models are used to model the costs and utility associated with a health state.</p>
<p><br><img src="simulation-flow.png" width="400px"><br><br></p>
<p>Probabilistic sensitivity analysis (PSA) is supported by default, as all modeled outcomes are based on sampled values of the parameters from appropriate probability distributions or via bootstrapping. Furthermore, predictions and simulations are made by patient according to the patient level covariates contained in the input data. <code>hesim</code> therefore also provides functions for decision analysis and quantifying the output of a PSA at the individual or subgroup level.</p>
</div>
<div id="model-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#model-structure" class="anchor"></a>Model structure</h2>
<p>The statistical models comprising a model structure are characterized by a distribution over outcomes, <span class="math inline">\(y\)</span>, which depend on model parameters, <span class="math inline">\(\alpha_1, \ldots, \alpha_L\)</span>,</p>
<p><span class="math display">\[
\begin{aligned}
P(y| \alpha_1(x_1), \ldots, \alpha_L(x_L)).
\end{aligned}
\]</span> The <span class="math inline">\(l\)</span>th model parameter can depend on a vector of coefficients, <span class="math inline">\(\beta_l\)</span>, and an input vector, <span class="math inline">\(x_l\)</span>, of covariates through linked transformed linear models <span class="math inline">\(g(\alpha_l(x_l)) = x_l^T \beta_l\)</span>. The outcomes, <span class="math inline">\(y\)</span>, can be predicted using the mean of the distribution, <span class="math inline">\(E(y|\cdot)\)</span>, or sampled with a random draw from the probability distribution, <span class="math inline">\(P(y|\cdot)\)</span>.</p>
<div id="parameter-estimates" class="section level3">
<h3 class="hasAnchor">
<a href="#parameter-estimates" class="anchor"></a>Parameter estimates</h3>
<p>In <code>hesim</code>, the sampled values of the coefficients for each parameter are generally stored in matrices (or a single matrix if the model only has one parameter), where the columns of each matrix are covariates and the rows are random samples. Parameters for statistical models are stored in objects prefixed by <code>params_</code> (e.g., <code>params_surv</code> for a survival model, <code>params_lm</code> for a linear model). A <code>params_</code> prefixed object can be created in one of two ways:</p>
<ol style="list-style-type: decimal">
<li>With a function of the same name such as <code><a href="../reference/params_surv.html">params_surv()</a></code> or <code><a href="../reference/params_lm.html">params_lm()</a></code>
</li>
<li>By using the generic function <code><a href="../reference/create_params.html">create_params()</a></code> to create objects from fitted statistical models</li>
</ol>
<p>This flexibility is provided so that parameters can either be estimated using models fit with <code>R</code> or from an external source. To illustrate, consider the shape and scale parameters of a Weibull survival model, which are stored in a <code>params_surv</code> object (note that <code>hesim</code> accepts Weibull distributions by the name “weibull” or “weibull.quiet”).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"hesim"</span>)
<span class="kw">library</span>(<span class="st">"flexsurv"</span>)
n_samples &lt;-<span class="st"> </span><span class="dv">3</span>

<span class="co"># Create from fitted R model</span>
fit_wei &lt;-<span class="st"> </span>flexsurv<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/flexsurv/topics/flexsurvreg">flexsurvreg</a></span>(<span class="dt">formula =</span> <span class="kw">Surv</span>(endpoint1_time, endpoint1_status) <span class="op">~</span><span class="st"> </span>female <span class="op">+</span><span class="st"> </span>age, 
                                <span class="dt">data =</span> psm4_exdata<span class="op">$</span>survival, <span class="dt">dist =</span> <span class="st">"weibull"</span>)
params_wei &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_params.html">create_params</a></span>(fit_wei, <span class="dt">n =</span> n_samples)
<span class="kw">print</span>(params_wei)</code></pre></div>
<pre><code>## $coefs
## $coefs$shape
##            shape
## [1,] -0.03176685
## [2,] -0.03677593
## [3,]  0.01287129
## 
## $coefs$scale
##             scale     female          age
## [1,]  0.002495926 0.08856634 -0.009766860
## [2,] -0.083490961 0.03144871 -0.008050678
## [3,]  0.160948374 0.06023180 -0.012072099
## 
## 
## $dist
## [1] "weibull.quiet"
## 
## $n_samples
## [1] 3
## 
## attr(,"class")
## [1] "params_surv"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create with 'params_surv()'</span>
coefs &lt;-<span class="st"> </span>flexsurv<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/flexsurv/topics/normboot.flexsurvreg">normboot.flexsurvreg</a></span>(fit_wei, <span class="dt">B =</span> n_samples, <span class="dt">raw =</span> <span class="ot">TRUE</span>)
params_wei2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/params_surv.html">params_surv</a></span>(<span class="dt">coefs =</span> <span class="kw">list</span>(<span class="dt">shape =</span> coefs[, <span class="st">"shape"</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>],
                                        <span class="dt">scale =</span> coefs[, <span class="kw">c</span>(<span class="st">"scale"</span>, <span class="st">"female"</span>, <span class="st">"age"</span>)]),
                          <span class="dt">dist =</span> <span class="st">"weibull"</span>)
<span class="kw">print</span>(params_wei2)</code></pre></div>
<pre><code>## $coefs
## $coefs$shape
##          shape
## [1,] 0.9573799
## [2,] 1.0080345
## [3,] 0.9815115
## 
## $coefs$scale
##          scale       female          age
## [1,] 1.1069607 -0.006377828 -0.011793709
## [2,] 1.0926515  0.069947974 -0.011671488
## [3,] 0.9226565  0.018173334 -0.007595761
## 
## 
## $dist
## [1] "weibull"
## 
## $n_samples
## [1] 3
## 
## attr(,"class")
## [1] "params_surv"</code></pre>
</div>
<div id="input-data" class="section level3">
<h3 class="hasAnchor">
<a href="#input-data" class="anchor"></a>Input data</h3>
<p>The input vectors for each parameter, <span class="math inline">\(x_{l,hijk}\)</span>, are rows in multidimensional input matrices, <span class="math inline">\(X_l\)</span>, where each row denotes a unique observation. The input matrix for parameter <span class="math inline">\(l\)</span> is indexed by health-related indices, <span class="math inline">\(h\)</span>, patients, <span class="math inline">\(i\)</span>, and treatment lines <span class="math inline">\(j\)</span> for a treatment strategy <span class="math inline">\(k\)</span>. Example health-related indices include a health state, a transition between two health states, or a survival endpoint in a partitioned survival model (PSM). In some cases, the health-related index <span class="math inline">\(h\)</span> can be suppressed and separate models can be fit for each health index. This is, for instance, the case in a PSM where separate models are fit for each survival endpoint. Likewise, models can be fit without multiple treatment lines as would, again, be the case in a PSM where sequential treatment would be incorporated by adding additional health states.</p>
<p>In <code>hesim</code>, simulations are made by constructing an object of class <code>input_data</code> with the function <code><a href="../reference/input_data.html">input_data()</a></code>, which consists of an input matrix <span class="math inline">\(X\)</span> and the indices <span class="math inline">\(h\)</span>, <span class="math inline">\(i\)</span>, <span class="math inline">\(j\)</span>, and <span class="math inline">\(k\)</span>. We illustrate in the figure below with an example in which a statistical model with one parameter is used to make predictions across two treatment strategies, two patients, and two health states. (If a statistical model with more than one parameter were used, then a separate input matrix would need to be created for each parameter.)</p>
<p><br><img src="input-data.png" width="500px"><br><br></p>
<p><code>hesim</code> provides helper functions for constructing objects of class <code>input_data</code>. Specifically, an <code>input_data</code> object can be created by following a three step process.</p>
<ol style="list-style-type: decimal">
<li>Using <code><a href="../reference/hesim_data.html">hesim_data()</a></code> to create a collection of data tables (i.e., a <code>data.frame</code> or <code>data.table</code>) of class <code>hesim_data</code> for storing relevant simulation data (e.g., a treatment strategy table, a patient table, a health state table), which would contain any variables needed for prediction with a statistical model</li>
<li>Using <code><a href="../reference/expand_hesim_data.html">expand_hesim_data()</a></code> to combine some or all of the tables created by <code><a href="../reference/hesim_data.html">hesim_data()</a></code> into a single long dataset of class <code>expanded_hesim_data</code> with dimensions required for predicting or simulating values with a particular submodel</li>
<li>Using the dataset in Step 2 to create an object of class <code>input_data</code> with <code><a href="../reference/create_input_data.html">create_input_data()</a></code>
</li>
</ol>
<p>The figure below illustrated this process using the same example above with two treatment strategies, two patients, and two health states.</p>
<p><br><img src="create-input-data.png" width="700px"><br><br> To illustrate with <code>R</code>, consider a simple PSM where the only survival endpoint is overall survival, so that there is only one (non-death) health state. Furthermore, suppose that there are two treatment strategies and two patients. A <code>hesim_data</code> object can be created as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt_strategies &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">strategy_id =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
dt_patients &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">patient_id =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">2</span>),
                          <span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">45</span>, <span class="dv">50</span>),
                          <span class="dt">female =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))
dt_states &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">state_id =</span>  <span class="dv">1</span>,
                        <span class="dt">state_name =</span> <span class="st">"Alive"</span>,
                        <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
hesim_dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hesim_data.html">hesim_data</a></span>(<span class="dt">strategies =</span> dt_strategies,
                              <span class="dt">patients =</span> dt_patients,
                              <span class="dt">states =</span> dt_states)
<span class="kw">print</span>(hesim_dat)</code></pre></div>
<pre><code>## $strategies
##   strategy_id
## 1           1
## 2           2
## 
## $patients
##   patient_id age female
## 1          1  45      0
## 2          2  50      1
## 
## $states
##   state_id state_name
## 1        1      Alive
## 
## attr(,"class")
## [1] "hesim_data"</code></pre>
<p>The <code>hesim_data</code> object can subsequently be “expanded” over the dimensions of interest using <code><a href="../reference/expand_hesim_data.html">expand_hesim_data()</a></code>. The new <code>expanded_hesim_data</code> object must contain the covariates used in the model fit as well as id variables indexing the dimensions of the data. Given a model object or formula, we extract the input matrix from the <code>expanded_hesim_data</code> object using the generic function <code><a href="../reference/create_input_data.html">create_input_data()</a></code>, which returns an <code>input_data</code> object containing the input matrix as well as the relevant id variables.</p>
<p>As with parameter estimation, an <code>input_data</code> object can be created in one of two ways:</p>
<ol style="list-style-type: decimal">
<li>From a model fit using R</li>
<li>Based on the covariates from a model fit outside of <code>R</code>
</li>
</ol>
<p>In case 2 a <code>formula</code> or <code>formula_list</code> object can be used in lieu of a fitted model. To illustrate, suppose we would like to predict survival curves by treatment strategy and patient using our fitted Weibull model. We first expand our <code>hesim_data</code> object using the strategies and patients tables so that we have a dataset where each row is a unique treatment strategy and patient. We then use <code><a href="../reference/create_input_data.html">create_input_data()</a></code> to create (i) a model matrix, <code>X</code>, for each parameter (the shape parameter only includes an intercept while the scale parameter includes an age covariate and a dummy variable for gender) and (ii) <code>strategy_id</code> and <code>patient_id</code> variables indicating the strategy and patient represented by each row in the list of matrices. In addition, the number of unique strategies and patients being modeled are returned based on the id variables specified.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Predict survival curves by treatment strategy and patient</span>
## From a model fit with flexsurvreg
hesim_edata_surv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expand_hesim_data.html">expand_hesim_data</a></span>(hesim_dat, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"strategies"</span>, <span class="st">"patients"</span>))
input_dat_wei &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_input_data.html">create_input_data</a></span>(fit_wei, <span class="dt">data =</span> hesim_edata_surv)
<span class="kw">print</span>(input_dat_wei)</code></pre></div>
<pre><code>## $X
## $X$shape
##   (Intercept)
## 1           1
## 2           1
## 3           1
## 4           1
## attr(,"assign")
## [1] 0
## 
## $X$scale
##   (Intercept) female age
## 1           1      0  45
## 2           1      1  50
## 3           1      0  45
## 4           1      1  50
## attr(,"assign")
## [1] 0 1 2
## 
## 
## $strategy_id
## [1] 1 1 2 2
## 
## $n_strategies
## [1] 2
## 
## $patient_id
## [1] 1 2 1 2
## 
## $n_patients
## [1] 2
## 
## attr(,"class")
## [1] "input_data"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## From a formula object
formula_list_wei &lt;-<span class="st"> </span><span class="kw"><a href="../reference/formula_list.html">formula_list</a></span>(<span class="dt">shape =</span> <span class="op">~</span><span class="dv">1</span>,
                                  <span class="dt">scale =</span> <span class="op">~</span><span class="st"> </span>female <span class="op">+</span><span class="st"> </span>age)
input_dat_wei2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_input_data.html">create_input_data</a></span>(formula_list_wei, <span class="dt">data =</span> hesim_edata_surv)</code></pre></div>
<p>We can create input data to make predictions by treatment strategy, patient, and health state (e.g., for our utility and cost models) in a similar fashion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Predict (mean) state values by treatment strategy, patient, and health state</span>
hesim_edata_statevals &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expand_hesim_data.html">expand_hesim_data</a></span>(hesim_dat, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"strategies"</span>, <span class="st">"patients"</span>, <span class="st">"states"</span>))
formula_costs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/formula_list.html">formula_list</a></span>(<span class="dt">mu =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>female)
<span class="kw">print</span>(<span class="kw"><a href="../reference/create_input_data.html">create_input_data</a></span>(formula_costs, <span class="dt">data =</span> hesim_edata_statevals))</code></pre></div>
<pre><code>## $X
## $X$mu
##   (Intercept) female
## 1           1      0
## 2           1      1
## 3           1      0
## 4           1      1
## attr(,"assign")
## [1] 0 1
## 
## 
## $strategy_id
## [1] 1 1 2 2
## 
## $n_strategies
## [1] 2
## 
## $patient_id
## [1] 1 2 1 2
## 
## $n_patients
## [1] 2
## 
## $state_id
## [1] 1 1 1 1
## 
## $n_states
## [1] 1
## 
## attr(,"class")
## [1] "input_data"</code></pre>
</div>
</div>
<div id="running-a-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#running-a-simulation" class="anchor"></a>Running a simulation</h2>
<p>A decision model is created by combining the disease, utility, and cost models. Each submodel is, in turn, created by combining input data and parameter estimates. For example, in a PSM there are three submodels: a set of survival models, a utility model, and a set of cost models for different types of costs. The survival models are <code>R6</code> objects of class <code>PsmCurves</code> and used to predict the survival curves in a PSM. The cost and utility models are <code>R6</code> objects of class <code>StateValues</code> and used to predict the values to assign to the health states.</p>
<p>Again, as with the model parameters and input data, there are two ways to instantiate each submodel:</p>
<ol style="list-style-type: decimal">
<li>Based on parameters and input data using <code>$new()</code>
</li>
<li>From fitted statistical models using generic functions prefixed by <code>create_</code> (e.g., <code><a href="../reference/create_PsmCurves.html">create_PsmCurves()</a></code>, <code><a href="../reference/create_StateVals.html">create_StateVals()</a></code>).</li>
</ol>
<p>We illustrate by instantiating a <code>PsmCurves</code> object in both ways.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Instantiate from a 'partsurvfit' object</span>
psfit_wei &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partsurvfit.html">partsurvfit</a></span>(<span class="kw"><a href="../reference/flexsurvreg_list.html">flexsurvreg_list</a></span>(fit_wei), <span class="dt">data =</span> psm4_exdata<span class="op">$</span>survival)
psm_curves &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_PsmCurves.html">create_PsmCurves</a></span>(psfit_wei, <span class="dt">data =</span> hesim_edata_surv,
                               <span class="dt">n =</span> n_samples, <span class="dt">bootstrap =</span> <span class="ot">FALSE</span>)

<span class="co"># Instantiate with $new()</span>
params_wei_list &lt;-<span class="st"> </span><span class="kw"><a href="../reference/params_surv_list.html">params_surv_list</a></span>(params_wei)
input_dat_wei_list &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_input_data.html">create_input_data</a></span>(<span class="kw"><a href="../reference/formula_list.html">formula_list</a></span>(formula_list_wei),
                                        <span class="dt">data =</span> hesim_edata_surv)
psm_curves2 &lt;-<span class="st"> </span>PsmCurves<span class="op">$</span><span class="kw">new</span>(<span class="dt">params =</span> <span class="kw"><a href="../reference/params_surv_list.html">params_surv_list</a></span>(params_wei),
                             <span class="dt">data =</span> input_dat_wei_list)</code></pre></div>
<p>Submodels such as <code>PsmCurves</code> have a number of member functions that can be used for prediction, simulation, or to evaluate model fit. For example, we can summarize survival curves from a <code>PsmCurves</code> object with functions to predict hazards, cumulative hazards, survival, restricted mean survival time, and quantiles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">psm_wei &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partsurvfit.html">partsurvfit</a></span>(<span class="kw"><a href="../reference/flexsurvreg_list.html">flexsurvreg_list</a></span>(fit_wei), <span class="dt">data =</span> psm4_exdata<span class="op">$</span>survival)
psm_curves &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_PsmCurves.html">create_PsmCurves</a></span>(psm_wei, <span class="dt">data =</span> hesim_edata_surv,
                               <span class="dt">n =</span> n_samples, <span class="dt">bootstrap =</span> <span class="ot">FALSE</span>)
<span class="kw">head</span>(psm_curves<span class="op">$</span><span class="kw">quantile</span>(.<span class="dv">5</span>))</code></pre></div>
<pre><code>##    curve sample strategy_id patient_id   p  quantile
## 1:     1      1           1          1 0.5 0.4211361
## 2:     1      1           1          2 0.5 0.4383557
## 3:     1      1           2          1 0.5 0.4211361
## 4:     1      1           2          2 0.5 0.4383557
## 5:     1      2           1          1 0.5 0.4538801
## 6:     1      2           1          2 0.5 0.4233809</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(psm_curves<span class="op">$</span><span class="kw">cumhazard</span>(<span class="dt">t =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>)))</code></pre></div>
<pre><code>##    curve sample strategy_id patient_id t cumhazard
## 1:     1      1           1          1 0  0.000000
## 2:     1      1           1          1 1  1.649278
## 3:     1      1           1          1 2  3.303986
## 4:     1      1           1          1 3  4.960748
## 5:     1      1           1          2 0  0.000000
## 6:     1      1           1          2 1  1.584341</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(psm_curves<span class="op">$</span><span class="kw">rmst</span>(<span class="dt">t =</span> <span class="dv">3</span>))</code></pre></div>
<pre><code>##    curve sample strategy_id patient_id t      rmst
## 1:     1      1           1          1 3 0.6022120
## 2:     1      1           1          2 3 0.6258862
## 3:     1      1           2          1 3 0.6022120
## 4:     1      1           2          2 3 0.6258862
## 5:     1      2           1          1 3 0.6481710
## 6:     1      2           1          2 3 0.6063766</code></pre>
<p>We can instantiate a <code>StateVals</code> object in the same two ways, although here we only use the second method. A <code>$simulate()</code> function is available to simulate state values by treatment strategy, patient, and health state.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">medcost_dat &lt;-<span class="st"> </span><span class="kw">subset</span>(psm4_exdata<span class="op">$</span>costs<span class="op">$</span>medical, state_name <span class="op">==</span><span class="st"> "state3"</span>)
medcosts_fit &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(costs <span class="op">~</span><span class="st"> </span>female, <span class="dt">data =</span> medcost_dat)
psm_medcosts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_StateVals.html">create_StateVals</a></span>(medcosts_fit, 
                                 <span class="dt">data =</span> hesim_edata_statevals, <span class="dt">n =</span> n_samples)
<span class="kw">head</span>(psm_medcosts<span class="op">$</span><span class="kw">sim</span>(<span class="dt">t =</span> <span class="dv">3</span>, <span class="dt">type =</span> <span class="st">"predict"</span>))</code></pre></div>
<pre><code>##    state_id sample strategy_id patient_id time    value
## 1:        1      1           1          1    3 34610.36
## 2:        1      1           1          2    3 34109.65
## 3:        1      1           2          1    3 34610.36
## 4:        1      1           2          2    3 34109.65
## 5:        1      2           1          1    3 37513.16
## 6:        1      2           1          2    3 38263.98</code></pre>
<p>By combining submodels, a decision model is able to simulate disease progression and cost and utility values associated with each disease state. Total discounted costs and QALYs are calculated by summing (or integrating) simulated costs and utility over time. In the PSM example, disease progression is simulated by first generating survival curves and then calculating health states probabilities based on those curves. Cost and QALYs are calculated by numerically integrating the weighted probability of being in each state, where weights are a function of the discount factorand predicted state values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">times &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, .<span class="dv">01</span>)
psm &lt;-<span class="st"> </span>Psm<span class="op">$</span><span class="kw">new</span>(<span class="dt">survival_models =</span> psm_curves,
              <span class="dt">cost_models =</span> <span class="kw">list</span>(<span class="dt">medical =</span> psm_medcosts))
psm<span class="op">$</span><span class="kw">sim_survival</span>(<span class="dt">t =</span> times)
psm<span class="op">$</span><span class="kw">sim_stateprobs</span>()
psm<span class="op">$</span><span class="kw">sim_costs</span>(<span class="dt">dr =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">03</span>))
<span class="kw">head</span>(psm<span class="op">$</span>costs_)</code></pre></div>
<pre><code>##    state_id sample strategy_id patient_id dr category    costs
## 1:        1      1           1          1  0  medical 20843.24
## 2:        1      1           1          2  0  medical 21349.20
## 3:        1      1           2          1  0  medical 20843.24
## 4:        1      1           2          2  0  medical 21349.20
## 5:        1      2           1          1  0  medical 24315.42
## 6:        1      2           1          2  0  medical 23202.90</code></pre>
</div>
<div id="decision-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#decision-analysis" class="anchor"></a>Decision analysis</h2>
<p>Once costs and QALYS have been calculated, the PSA output can be summarized with measures commonly used for technology assessment including:</p>
<ul>
<li>cost-effectiveness planes</li>
<li>cost-effectiveness acceptability curves (CEACs)</li>
<li>the expected value of perfect information (EVPI)</li>
</ul>
<p>Moreover, since patient level outcomes are modeled, output can be summarized by patient or subgroup. These “individualized cost-effectiveness analyses” are performed with the <code><a href="../reference/icea.html">icea()</a></code> function. A detailed explanation is given <a href="icea.html">here</a>.</p>
</div>
<div id="future-development" class="section level2">
<h2 class="hasAnchor">
<a href="#future-development" class="anchor"></a>Future development</h2>
<p><code>hesim</code> currently supports N-state PSMs; however, the package is being actively developed and support for state transition modeling and individual patient simulation will be added. In addition, we plan to add support for additional statistical techniques such as generalized linear models.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#model-structure">Model structure</a></li>
      <li><a href="#running-a-simulation">Running a simulation</a></li>
      <li><a href="#decision-analysis">Decision analysis</a></li>
      <li><a href="#future-development">Future development</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
